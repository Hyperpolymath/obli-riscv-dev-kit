= Note G Cookbook
Jonathan D.A. Jewell <jonathan@hyperpolymath.org>
:toc: left
:toclevels: 3
:sectnums:
:icons: font
:source-highlighter: rouge
:experimental:

== Overview

This cookbook provides recipes, patterns, and command references for the Note G
language and obli-riscv-dev-kit project.

[#cli]
== CLI Reference

=== Just Commands

The primary task runner. All commands use the format: `just <command>`.

==== Build Commands

[source,bash]
----
# Build all components
just build

# Build specific components
just build-lang      # Note G language tooling
just build-ssg       # Static site generator
just build-engine    # Ada/SPARK engine
just build-site      # Generate site output
----

==== Test Commands

[source,bash]
----
# Run all tests
just test            # Unit tests only
just test-all        # Including E2E and accessibility

# Component-specific tests
just test-unit       # Unit tests
just test-lang       # Language tests
just test-ssg        # SSG tests
just test-engine     # Ada engine tests
just test-e2e        # End-to-end tests

# Accessibility tests
just test-a11y       # All accessibility tests
just test-bsl        # British Sign Language
just test-asl        # American Sign Language
just test-makaton    # Makaton symbols
----

==== Language Server

[source,bash]
----
# Start LSP
just lsp

# Compile, interpret, validate
just compile file.noteg html    # Compile to HTML
just compile file.noteg js      # Compile to JavaScript
just interpret file.noteg       # Run in interpreter
just validate file.noteg        # Syntax validation
----

==== Verification

[source,bash]
----
# Bernoulli verification
just verify          # Run verification
just verify-report   # Generate report
----

==== Accessibility

[source,bash]
----
# Accessibility checks
just a11y-check      # Full WCAG check
just a11y-report     # Generate report
----

==== Development

[source,bash]
----
# Development workflow
just dev             # Start dev server
just watch           # Watch and rebuild
just open            # Open in browser
just fmt             # Format code
just lint            # Lint code
just clean           # Clean artifacts
just rebuild         # Clean and build
----

==== Release

[source,bash]
----
# Release workflow
just release-check   # Verify ready for release
just release 0.2.0   # Create release
----

==== Container

[source,bash]
----
# Container operations
just container-build # Build image
just container-run   # Run container
----

==== Environment

[source,bash]
----
# Development shells
just shell           # Guix shell (primary)
just nix-shell       # Nix shell (fallback)
----

==== CI/CD Helpers

[source,bash]
----
# CI checks
just ci              # Run all CI checks
just check-scm       # Validate SCM files
just check-security  # Security audit
just check-rsr       # RSR compliance
----

=== Must Commands (Mandatory Checks)

These commands MUST pass before any merge. Use the `Mustfile`.

[source,bash]
----
# Security (mandatory)
must-no-secrets           # Check for hardcoded secrets
must-https-only           # Verify HTTPS only
must-no-weak-crypto       # No MD5/SHA1
must-sha-pinned-actions   # GitHub Actions SHA-pinned

# RSR Compliance (mandatory)
must-required-files       # Check required files exist
must-spdx-headers         # SPDX license headers
must-no-forbidden-langs   # No forbidden languages

# Accessibility (mandatory)
must-a11y-metadata        # A11y config present
must-sign-language-support # Sign language defined

# Documentation (mandatory)
must-core-docs            # README, LICENSE exist
must-valid-scm            # SCM files valid

# Combined
must-all                  # Run all checks
must-security             # Security only
must-rsr                  # RSR only
must-a11y                 # Accessibility only
----

[#nickel]
== Nickel Configuration

=== Configuration Patterns

Nickel provides type-safe configuration. Here are common patterns:

==== Site Configuration

[source,nickel]
----
# noteg.ncl - Site configuration
{
  site = {
    name = "My Note G Site",
    title = "Welcome",
    description = "An accessible website",
    baseUrl = "/",
    language = "en",
  },

  accessibility = {
    enabled = true,
    defaultLanguage = 'bsl,
    supportedLanguages = ['bsl, 'asl, 'gsl],
    makatonEnabled = true,
    wcagLevel = "AA",
  },

  build = {
    outputDir = "_site",
    minify = true,
    target = 'htmla11y,
  },
}
----

==== Accessibility Schema

[source,nickel]
----
# a11y.ncl - Accessibility configuration
let SignLanguage = [| 'bsl, 'asl, 'gsl, 'auslan, 'lsf, 'jsl |] in
let WcagLevel = [| "A", "AA", "AAA" |] in

{
  ContentA11y = {
    bsl | optional = {},
    asl | optional = {},
    gsl | optional = {},
    makaton | optional = {},
    altText | optional | String,
    longDesc | optional | String,
  },

  SignContent = {
    videoUrl | optional | String,
    transcript | optional | String,
    glosses | Array String | default = [],
    interpreter | optional | String,
  },

  MakatonContent = {
    symbols | Array { id : String, meaning : String },
    sequence | optional | String,
    level | optional | [| "core", "additional", "resource" |],
  },
}
----

==== Validation Rules

[source,nickel]
----
# validation.ncl - Input validation
let validateUrl = fun url =>
  std.string.is_match "^https://" url
in

let validateEmail = fun email =>
  std.string.is_match "^[^@]+@[^@]+\\.[^@]+$" email
in

{
  validators = {
    url = validateUrl,
    email = validateEmail,
    nonEmpty = fun s => std.string.length s > 0,
  },
}
----

[#just]
== Just Recipes

=== Recipe Patterns

==== Basic Recipe

[source,just]
----
# Simple recipe
hello:
    @echo "Hello, World!"
----

==== Recipe with Dependencies

[source,just]
----
# Recipe depending on others
all: build test lint
    @echo "All tasks complete"
----

==== Recipe with Arguments

[source,just]
----
# Recipe with positional argument
compile file target="html":
    @echo "Compiling {{ file }} to {{ target }}"
----

==== Conditional Recipe

[source,just]
----
# Check before running
build:
    @test -f package.json && deno task build || echo "No package.json"
----

==== Recipe with Environment

[source,just]
----
set dotenv-load := true

deploy:
    @echo "Deploying to $DEPLOY_URL"
----

=== Complete Recipe Examples

==== Full Build Pipeline

[source,just]
----
set shell := ["bash", "-uc"]

project := "my-project"
version := "0.1.0"

# Build all
build: clean compile bundle
    @echo "Built {{ project }} v{{ version }}"

# Clean outputs
clean:
    rm -rf dist/

# Compile sources
compile:
    deno task compile

# Bundle for distribution
bundle:
    deno task bundle
----

==== Test Pipeline

[source,just]
----
# Run all tests
test: test-unit test-integration
    @echo "All tests passed"

# Unit tests with coverage
test-unit:
    deno test --coverage=coverage/ tests/unit/

# Integration tests
test-integration:
    deno test tests/integration/

# Coverage report
coverage: test-unit
    deno coverage coverage/ --lcov > coverage.lcov
----

[#combinatorics]
== CLI Combinatorics

=== Command Permutations

Common command combinations for different workflows:

==== Development Workflow

[source,bash]
----
# Start fresh development session
just clean && just build && just dev

# Quick iteration
just fmt && just test && just build

# Full validation before commit
just fmt && just lint && just test-all && just check-security
----

==== CI Pipeline

[source,bash]
----
# Minimal CI
just ci

# Full CI with accessibility
just must-all && just test-all && just a11y-report

# Release validation
just must-all && just release-check
----

==== Debugging

[source,bash]
----
# Debug language issues
just validate file.noteg && just interpret file.noteg

# Debug build issues
just clean && just build-lang 2>&1 | head -50

# Check all SCM files
just check-scm && guile -c '(load "PLAYBOOK.scm")'
----

=== Command Concatenation Patterns

==== Sequential (&&)

Commands run only if previous succeeds:

[source,bash]
----
just test && just build && just deploy
----

==== Parallel (xargs/parallel)

Commands run concurrently:

[source,bash]
----
echo "test lint fmt" | xargs -P3 -n1 just
----

==== Conditional (||)

Fallback on failure:

[source,bash]
----
just build || (just clean && just build)
----

==== Pipeline

Output as input:

[source,bash]
----
just validate file.noteg 2>&1 | grep -i error
----

[#accessibility]
== Accessibility Recipes

=== Adding Sign Language Support

==== BSL (British Sign Language)

[source,noteg]
----
accessibility bsl {
  videoUrl: "https://example.com/videos/content-bsl.mp4",
  transcript: "Written English translation of the signed content",
  glosses: ["HELLO", "WELCOME", "WEBSITE"],
  interpreter: "Jane Smith (NRCPD)"
}
----

==== ASL (American Sign Language)

[source,noteg]
----
accessibility asl {
  videoUrl: "https://example.com/videos/content-asl.mp4",
  transcript: "English transcript",
  glosses: ["HELLO", "WELCOME"],
  dialect: "ASL-SE"  // Signing Exact English variant
}
----

==== GSL (German Sign Language / DGS)

[source,noteg]
----
accessibility gsl {
  videoUrl: "https://example.com/videos/content-dgs.mp4",
  transcript: "German transcript",
  glosses: ["HALLO", "WILLKOMMEN"]
}
----

=== Adding Makaton Support

[source,noteg]
----
accessibility makaton {
  symbols: [
    { id: "hello", meaning: "Hello", imageUrl: "/symbols/hello.png" },
    { id: "welcome", meaning: "Welcome", imageUrl: "/symbols/welcome.png" }
  ],
  sequence: "HELLO + WELCOME + YOU",
  level: "core",
  audioUrl: "/audio/hello-welcome.mp3"
}
----

=== WCAG Compliance Checklist

[cols="1,3,1"]
|===
|Criterion |Requirement |Status

|1.1.1 |Non-text Content: All images have alt text |[ ]
|1.2.1 |Audio-only/Video-only: Alternatives provided |[ ]
|1.2.5 |Audio Description: Video has description |[ ]
|1.3.1 |Info and Relationships: Semantic HTML |[ ]
|1.4.3 |Contrast: Minimum 4.5:1 ratio |[ ]
|2.1.1 |Keyboard: All interactive elements accessible |[ ]
|2.4.1 |Bypass Blocks: Skip links provided |[ ]
|3.1.1 |Language of Page: lang attribute set |[ ]
|4.1.1 |Parsing: Valid HTML |[ ]
|===

[#security]
== Security Recipes

=== Security Checks

[source,bash]
----
# Check for secrets
grep -rEi "(api_key|secret|password)" --include="*.res" .

# Check for HTTP URLs
grep -rE "http://[^l]" --include="*.res" --include="*.yaml" .

# Check for weak crypto
grep -rE "md5\(|sha1\(" --include="*.res" .

# Run full security audit
just must-security
----

=== SHA-Pinning GitHub Actions

[source,yaml]
----
# Bad (unpinned)
uses: actions/checkout@v4

# Good (SHA-pinned)
uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
----

=== Content Security Policy

[source,html]
----
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self';
               style-src 'self' 'unsafe-inline';
               img-src 'self' https:;
               media-src 'self' https:;">
----

[#templates]
== Template Recipes

=== Basic Template

[source,noteg]
----
// Simple variable substitution
let name = "World"
{{ name }}  // Output: World

// With filter
{{ name | upper }}  // Output: WORLD
----

=== Loops

[source,noteg]
----
let items = ["Apple", "Banana", "Cherry"]

for item in items {
  <li>{{ item }}</li>
}
----

=== Conditionals

[source,noteg]
----
let isLoggedIn = true

if isLoggedIn {
  <p>Welcome back!</p>
} else {
  <p>Please log in.</p>
}
----

=== Components

[source,noteg]
----
component Card(title, content, imageUrl) {
  <article class="card">
    <img src="{{ imageUrl }}" alt="{{ title }}">
    <h2>{{ title }}</h2>
    <p>{{ content }}</p>
  </article>
}

// Usage
Card("Hello", "Welcome to Note G", "/images/hero.jpg")
----

=== Accessibility-Enhanced Component

[source,noteg]
----
component AccessibleCard(title, content, a11yData) {
  <article class="card" role="article">
    <h2>{{ title }}</h2>
    <p>{{ content }}</p>

    accessibility bsl {
      videoUrl: a11yData.bslVideo,
      transcript: content
    }
  </article>
}
----

[#appendix]
== Appendix

=== File Locations

[cols="1,2"]
|===
|Path |Description

|`justfile` |Primary task runner
|`Mustfile` |Mandatory CI checks
|`noteg.config.json` |Site configuration
|`a11y/schema.json` |Accessibility schema
|`noteg-lang/src/` |Language implementation
|`ssg/src/` |Static site generator
|`engine/src/` |Ada/SPARK engine
|`tests/` |Test suites
|`content/` |Site content
|`templates/` |HTML templates
|===

=== Environment Variables

[cols="1,2,1"]
|===
|Variable |Description |Default

|`NOTEG_ENV` |Environment (dev/prod) |`dev`
|`NOTEG_OUTPUT` |Output directory |`_site`
|`NOTEG_A11Y_DEFAULT` |Default sign language |`bsl`
|===

=== Related Files

* link:PLAYBOOK.scm[Development Playbook]
* link:AGENTIC.scm[Agent Collaboration]
* link:NEUROSYM.scm[Neurosymbolic Patterns]
* link:META.scm[Architecture Decisions]
* link:STATE.scm[Project State]
* link:ECOSYSTEM.scm[Ecosystem Relationships]
